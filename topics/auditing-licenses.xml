<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic SYSTEM "https://resources.jetbrains.com/stardust/html-entities.dtd">

<topic xsi:noNamespaceSchemaLocation="https://resources.jetbrains.com/stardust/topic.v2.xsd"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       title="License audit"
       id="auditing-licenses.xml">

    <var name="feature" value="Qodana License Audit"/>

    <!-- I need to collect questions that need to be addressed to Viktor -->
    <!-- I need to explain how the linter works and searches for text licenses. I need to ask Viktor about it -->
    <!-- I need to reflect Viktor's information about how it collects information from unreadable files -->

    <p>It is quite common that an inspected application is licensed under a specific license, and it contains a bunch of
        dependencies being licensed under separate licenses. For example, the table explains whether the application
        license and licenses of three dependencies are compatible based on the
        <a href="https://spdx.org/licenses/">SPDX License List</a>.</p>

    <table>
        <tr>
            <td>Software</td>
            <td>Licensed under</td>
            <td>Allowed under the
                application license</td>
        </tr>
        <tr>
            <td>Application</td>
            <td>AFL-2.0</td>
            <td>&mdash;</td>
        </tr>
        <tr>
            <td>Dependency A</td>
            <td>AFL-2.1</td>
            <td>&#x2714;</td>
        </tr>
        <tr>
            <td>Dependency B</td>
            <td>CPL-1.0</td>
            <td>&#10008;</td>
        </tr>
        <tr>
            <td>Dependency C</td>
            <td>AFL-3.0</td>
            <td>&#x2714;</td>
        </tr>
    </table>

    <p>Manual verification of such information can become a tedious task. Besides that, it can be a source of mistakes
        that will have legal consequences.</p>

    <p>To automate the process of license verification and avoid mistakes, you can use the %feature% feature that
        implements the <a href="https://spdx.org/licenses/">SPDX License List</a> and provides
        <a anchor="license-audit-basic-run">basic functionality</a> for exploring license compatibility. In addition,
        you can alter this feature using these functionalities:</p>
    <list>
        <!-- This should contain two links to two subsections -->
        <li>Ignore dependency licenses</li>
        <li>Override dependency licenses</li>
        <li>Create customer dependencies to include them into the %product% report</li>
    </list>

    <p>Currently, this feature is included in all existing %product% <a href="linters.md">linters</a>, and you can use
        it for exploring the JPS, Maven, Gradle, npm, yarn and composer projects.</p>

    <chapter title="Running %feature%" id="license-audit-basic-run">

        <chapter title="Enabling the feature">
            <p>To enable %feature%, add these lines to the <code style="inline">qodana.yaml</code> file in your project
                root:</p>
            <code style="block" lang="yaml">
                include:
                  - name: CheckDependencyLicenses
            </code>

        </chapter>

        <chapter title="Ignoring dependencies">
            <p>For some reasons, you may need to ignore a specific dependency in your project, which you can additionally
                specify in <code style="inline">qodana.yaml</code>:</p>
            <code style="block" lang="yaml">
                dependencyIgnores:
                - name: "dependency/name"
            </code>
        </chapter>

        <!-- START FROM THIS PLACE -->
        <!-- I need to test it once more before submitting -->
        <!-- Reference to the license matrix should be given here -->
        <chapter title="Overriding the license matrix">
            <p>You can override the <a href="https://spdx.org/licenses/">license matrix</a> and specify the list of
                dependency licenses that are allowed or prohibited for the specific project license. In this example, the
            <code>AFL-2.0</code> project license becomes compatible with <code>AGPL-3.0-only</code> and incompatible with
                <code>Apache-1.0</code>:</p>
            <code style="block" lang="yaml">
                licenseRules:
                   - keys:
                   - "AFL-2.0"
                allowed:
                   - "AGPL-3.0-only"
                prohibited:
                   - "Apache-1.0"
            </code>

            Here, the <code>licenseRules</code>, <code>allowed</code>, and <code>prohibited</code> keys can accept multiple
            values.
        </chapter>

    </chapter>

    <chapter title="Verifying data">
    <p>Open the %product% report and click the <menupath>Project audit</menupath> tab to see more information about
        license audit results. </p>

        <!-- This needs to be unified with the UI overview section because they should be the same in both sections -->

    <img src="license-audit-tab.png" dark-src="license-audit-tab_dark.png" width="706" alt="The License Audit tab" border-effect="line"/>

    <!-- I need to describe why these tabs are here and what useful do they bring to the user -->
    <p>This tab contains several tabs, such as:</p>
    <list>
        <li><menupath>Languages</menupath> enumerates all technologies currently supported by %product%</li>
        <li><menupath>Translators</menupath> lists all technologies that were involved for inspecting the codebase</li>
        <li><menupath>Project License</menupath> contains information about the license used in the project</li>
        <li><menupath>Third-party licenses</menupath> lists all project dependencies and the licenses they use including dependencies
        that cannot be used under the current project license</li>
        <li><menupath>License rules</menupath> contains the table of license correspondence. The
            <menupath>Project license</menupath> column lists license names, while the
            <menupath>Allowed licenses</menupath> and the <menupath>Prohibited licenses</menupath> columns list the
            licenses that are compatible and incompatible with the license respectively. This can be helpful when you
            need to override licenses.
        </li>
    </list>

    <img src="license-audit-rules.png" dark-src="license-audit-rules_dark.png" width="706" alt="The License rules tab" border-effect="line"/>

    </chapter>



</topic>
